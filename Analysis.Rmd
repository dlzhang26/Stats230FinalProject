---
title: "Season's Informaiton and Post Injury Play Time For NFL Players"
author: 'Group D: Arthur, Donna, Kaitlyn, Michael'
date: "Friday, April 6, 2024"
output:
  pdf_document:
    fig_height: 3
    fig_width: 5
  word_document: default
---

```{r include=FALSE}
library(mosaic)
library(GGally)
require(tidyr)
library(tidyverse)
require(lattice)
library(gridExtra)
library(grid)
library(leaps)
library(lubridate) # finding age at a given date
options(scipen=5)
```

```{r include=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
# knitr settings to control how R chunks work.
require(knitr)
opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small"    # slightly smaller font for code
)
trellis.par.set(theme=theme.mosaic())  
options(digits=5)
```


```{r}
###############################################################################################
#getwd() in console to find the directory where the csv file is stored on your computer
#For your computer you need to change the path so you can reed the file
#alldata <- read.csv("/home/class26/FIRSTPARTOFEMAIL/ConcussionInjuries2012-2014.csv") 

##Donna's computer
df1 <- read.csv("C:/Users/donna/OneDrive/Documents/STAT230/Stats230FinalProject/ConcussionInjuries2012-2014.csv")
df2 <- read.csv("C:/Users/donna/OneDrive/Documents/STAT230/Stats230FinalProject/HeadInjuredPlayers.csv")


#For Kaitlyn's computer
#df1 <- read.csv("/home/class27/khuang27/StatsProjectFinal/ConcussionInjuries2012-2014.csv")
#df2 <- read.csv("/home/class27/khuang27/StatsProjectFinal/HeadInjuredPlayers.csv")

###############################################################################################
##Merge
## gets rid of players who had multiple injuries in the three years
mergeData <- merge(x = df2, y = df1[!duplicated(df1$Player), ], by = "Player", all.x = TRUE)
mergeData <- filter(mergeData, Reported.Injury.Type == "Concussion") ## filter so there's only concussions 

## qual --> quant var
mergeData$Play.Time.After.Injury = parse_number(mergeData$Play.Time.After.Injury)
mergeData$Average.Playtime.Before.Injury = parse_number(mergeData$Average.Playtime.Before.Injury)
###############################################################################################
##rename variables
nameData <- rename(mergeData, OppTeam = Opposing.Team, PostIPT = Play.Time.After.Injury, PreseasonInjury = Pre.Season.Injury., OnWinningTeam = Winning.Team., amtTimeInjured = Weeks.Injured, WeekOfInjury = Week.of.Injury, UnknownInjury = Unknown.Injury., ReportedTypeOfInjury = Reported.Injury.Type, PreIPT = Average.Playtime.Before.Injury, TotalSnaps = Total.Snaps, amtGamesMissed = Games.Missed, GM12 = X2012.2013...Games.Missed, GM13 = X2013.2014...Games.Missed, GM14 = X2014.2015...Games.Missed, I12 = X2012.2013...Number.of.Injuries , I13 = X2013.2014...Number.of.Injuries, I14 = X2014.2015...Number.of.Injuries, TotalInjuries = Total.Number.of.Injuries..2012.2014., PosDuringInjury = Roles.during.injuries, DOB = Date.of.Birth, AgeFirstConcussion = Age.first.concussion..2012.2014., totalGamesMissed = Total.Games.Missed..2012.2014., TeamDurConcussion = Team.s..during.concussion.incidents.2012.2014, DOI = Date)

###############################################################################################
## select variables 
studyD <- nameData %>% 
  select(PostIPT, PreseasonInjury, Season, amtGamesMissed, PreIPT, WeekOfInjury, TotalSnaps, Player, I12, I13, I14, TotalInjuries, GM12, GM13, GM14,totalGamesMissed, DOB, DOI, AgeFirstConcussion, Position)

## getting the current age 
# Convert DOB to date objects
studyD$DOB <- as.Date(as.character(studyD$DOB), format = "%d/%m/%Y")

# Calculate current age
given_date <- as.Date("2024-04-01")
current_age_in_years <- as.numeric(interval(studyD$DOB, given_date) / dyears(1))
studyD$CurrentAge <- round(current_age_in_years, 1)

#############################################################################
## this re-categorizes position to offense and defense
studydata <- studyD %>% 
    mutate(Position = case_when(
    Position %in% c("Defensive End", "Defensive Tackle", "Safety", "Comerback" ) ~ "defense",
    Position %in% c("Long Snapper", "Wide Receiver", "Tight End", "Linebacker", "Quarterback", "Center", "Guard", "Full Back", "Running Back", "Offensive Tackle") ~ "offense"))

#############################################################################
## creating population and sample
predictData <-filter(studydata, Season == "2014/2015") ## data for the season we're predicting
finalData <- filter(studydata, Season != "2014/2015") ## our sample data
```
*Project Question/Aim*

Concussions have been a trending topic in football for the last few years as current and former players suffer the consequences of such a physical sport. We want to determine if there is a significant relationship between Post-Injury Play Time and our chosen predictor variables, and if the model derived from the first two years of data can predict a player’s Post-Injury Play Time in the third season. 

*Variables*

Our response variables is Post-Injury Play Time. Our explanatory variables that we are using are WeekOfInjury, Position, PreseasonInjury, Season, amtGamesMissed, and PreIPT. PreseasonInjury, Position, Season are qualitative variables and amtGamesMissed, PreIPT, WeekOfInjury are quantitative variables. 

*Step 1: Univariate analysis - descriptive stats/plots for each variable*
RESPONSE VARIABLE: 
Post-Injury Play Time - Descriptive statistics and a frequency histogram with a density plot are shown below. 
```{r}
##PostIPT RESPONSE VARIABLE
favstats(~PostIPT, data = finalData)
gf_dhistogram(~PostIPT, data = finalData)%>%
  gf_dens()

```

EXPLANATORY VARIABLES:
WeekOfInjury, Position, PreseasonInjury, Season, amtGamesMissed, and PreIPT are shown below as frequency histograms. 
```{r}
##EXPLANATORY VARIABLES

## quantitative

m1 <- gf_histogram(~amtGamesMissed, data = finalData)

m2 <- gf_dhistogram(~PreIPT, data = finalData) %>%
  gf_dens()

m3 <- gf_histogram(~WeekOfInjury, data = finalData, main = "Distribution of Week of Injury")


grid.arrange(m1, m2, m3, ncol = 3 ,heights = .5) 

gf_dhistogram(~AgeFirstConcussion, data = finalData, main = "AgeOfFirstConcussion") %>%
  gf_dens()
gf_dhistogram(~CurrentAge, data = finalData, main = "currentage") %>%
  gf_dens()


##qualitative
m4 <- gf_bar(~ PreseasonInjury, data = finalData, fill = c("darkred", "forestgreen"), main = "Number of Preseason Injuries")

tally(~ Position, data = finalData)

m5 <- gf_bar(~Season, data = finalData)

grid.arrange(m4, m5, ncol = 2 ,heights = .5) 

```

*Step 2: Compare variables in Bivariate Manner -  Stats, Plots, and Compare*

We will make the following comparisons in a bivariate manner:

*Post-Injury Play-Time vs. Position.* We will represent this with a box plot, where the two categories are defense and offense. 

*Post-Injury Play-Time vs. Pre-Season Injury.* We will represent this with a box plot, in which the two categories are “No,” the player didn’t sustain an injury in the pre-season, and “Yes,” the player did sustain an injury in the pre-season. 

*Post-Injury Play-Time vs. Season.* We will represent this with a box plot, in which the two categories are the 2012-2013 season and the 2013-2014 season. 

*Post-Injury Play-Time vs. Post-Injury Play Time.* We will represent this with a scatterplot. 

*Post-Injury Play-Time vs. Week of Injury.* We will represent this with a scatterplot.

*Post-Injury Play-Time vs. amtGamesMissed.* We will represent this with a scatterplot.

A ggpairs of all the relationships is shown below, and which we will use to identify their correlations as well as any cases of multicollinearity. If there is indeed multicollinearity, we can use VIF to determine which variables are responsible.

```{r}
finalData1 <- select(finalData, "PostIPT" , "amtGamesMissed", "PreIPT", "WeekOfInjury", "PreseasonInjury", "Position", "Season", "CurrentAge", "AgeFirstConcussion")
ggpairs(finalData1)

```
```{r}
finalData1 <- filter(finalData1, PreseasonInjury == "No") ## our sample data
#ggpairs(finalData1)
```



*Step 3: Model Building and Variable Selection - Choosing Variables, Checking/Evaluating Fit, and Final Model Criteria*